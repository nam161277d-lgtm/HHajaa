<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DEV WITE TOOL</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont}
body{margin:0;background:#020617;color:#e5e7eb}
.container{max-width:420px;margin:auto;padding:16px}
.card{background:#0b1220;border-radius:18px;padding:18px;margin-top:16px}
h1{text-align:center;color:#3b82f6;margin:0}
.sub{text-align:center;color:#9ca3af;font-size:13px}
input,button{
  width:100%;padding:14px;border-radius:14px;
  border:none;font-size:15px;margin-top:10px
}
input{background:#020617;color:#e5e7eb}
button{font-weight:600;cursor:pointer}
.blue{background:#2563eb;color:#fff}
.gray{background:#1f2937;color:#e5e7eb}
.green{background:#22c55e;color:#04110a}
.red{background:#dc2626;color:#fff}
.hide{display:none}
.code{
  font-size:28px;letter-spacing:4px;
  background:#020617;border-radius:12px;
  padding:12px;text-align:center;margin-top:10px
}
.avatar{
  position:fixed;top:12px;right:12px;
  width:40px;height:40px;border-radius:50%;
  background:#2563eb;color:#fff;
  display:none;align-items:center;justify-content:center;
  font-weight:700;cursor:pointer
}
</style>
</head>

<body>

<div class="avatar" id="avatar" onclick="openProfile()">U</div>

<div class="container">

<!-- AUTH -->
<div id="authBox" class="card">
  <h1>DEV WITE</h1>
  <div class="sub">Đăng ký / Đăng nhập</div>

  <input id="phone" placeholder="Số điện thoại">
  <input id="pass" type="password" placeholder="Mật khẩu">

  <button class="blue" onclick="register()">Đăng ký</button>
  <button class="gray" onclick="login()">Đăng nhập</button>
  <button class="gray" onclick="openForgot()">Quên mật khẩu?</button>

  <div id="msg" class="sub"></div>
</div>

<!-- APP -->
<div id="app" class="card hide">
  <button class="gray" onclick="showTab('pass')">Change Pass</button>
  <button class="gray" onclick="showTab('fa')">2FA</button>
  <button class="gray" onclick="showTab('renew')">Gia hạn</button>

  <!-- CHANGE PASS -->
  <div id="passTab" class="hide">
    <input id="uid" placeholder="UID">
    <input id="code" placeholder="CODE MAIL">
    <button class="blue" onclick="genLinks()">Tạo link</button>
    <button class="gray" onclick="openLink(1)">Ver1</button>
    <button class="gray" onclick="openLink(2)">Ver2</button>
    <button class="gray" onclick="openLink(3)">Ver3</button>
  </div>

  <!-- 2FA -->
  <div id="faTab" class="hide">
    <input id="faName" placeholder="Tên 2FA">
    <input id="faSecret" placeholder="Secret">
    <button class="green" onclick="add2FA()">GET MÃ</button>
    <div id="totp" class="code">------</div>
    <div id="faList"></div>
  </div>

  <!-- RENEW -->
  <div id="renewTab" class="hide">
    <p class="sub">Liên hệ admin để gia hạn</p>
    <a href="https://t.me/wite_dev" target="_blank"
      style="display:block;text-align:center"
      class="blue">Telegram @wite_dev</a>
  </div>

  <button class="red" onclick="logout()">Đăng xuất</button>
</div>
</div>

<!-- FORGOT -->
<div id="forgot" class="hide">
</div>

<script>
const ACC="DEVWITE_ACCOUNTS";
const LOGIN="DEVWITE_LOGIN";
const SESS="DEVWITE_SESSIONS";

function getAcc(){return JSON.parse(localStorage.getItem(ACC)||"{}")}
function saveAcc(a){localStorage.setItem(ACC,JSON.stringify(a))}

async function hash(t){
  const b=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t));
  return [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("");
}

async function register(){
  const a=getAcc();
  if(a[phone.value])return msg.innerText="Đã tồn tại";
  a[phone.value]={pass:await hash(pass.value),expire:null,twofa:[]};
  saveAcc(a);
  msg.innerText="Đăng ký thành công";
}

async function login(){
  const a=getAcc();
  if(!a[phone.value])return msg.innerText="Không tồn tại";
  if(a[phone.value].pass!==await hash(pass.value))
    return msg.innerText="Sai mật khẩu";

  localStorage.setItem(LOGIN,phone.value);
  location.reload();
}

function logout(){
  localStorage.removeItem(LOGIN);
  location.reload();
}

function showTab(t){
  passTab.classList.add("hide");
  faTab.classList.add("hide");
  renewTab.classList.add("hide");
  document.getElementById(t+"Tab").classList.remove("hide");
}

let links={};
function genLinks(){
  links={
    1:`https://www.site.com/?u=${uid.value}&n=${code.value}`,
    2:`https://www.site.com/?u=${uid.value}&n=${code.value}&v=2`,
    3:`https://www.site.com/?u=${uid.value}&n=${code.value}&v=3`
  };
}
function openLink(v){window.open(links[v],"_blank")}

/* 2FA */
async function totp(sec){
  const base32="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
  let b="";sec=sec.replace(/=+$/,"");
  for(const c of sec)b+=base32.indexOf(c).toString(2).padStart(5,"0");
  let arr=[];for(let i=0;i+8<=b.length;i+=8)arr.push(parseInt(b.slice(i,i+8),2));
  const key=await crypto.subtle.importKey("raw",new Uint8Array(arr),{name:"HMAC",hash:"SHA-1"},false,["sign"]);
  const buf=new ArrayBuffer(8);new DataView(buf).setUint32(4,Math.floor(Date.now()/1000/30));
  const h=new Uint8Array(await crypto.subtle.sign("HMAC",key,buf));
  const o=h[h.length-1]&15;
  return(((h[o]&127)<<24|(h[o+1]<<16)|(h[o+2]<<8)|h[o+3])%1e6).toString().padStart(6,"0");
}

async function add2FA(){
  const p=localStorage.getItem(LOGIN);
  const a=getAcc();
  a[p].twofa.push({name:faName.value,secret:faSecret.value});
  saveAcc(a);
  render2FA();
}

async function render2FA(){
  const p=localStorage.getItem(LOGIN);
  const a=getAcc()[p];
  faList.innerHTML="";
  for(const x of a.twofa){
    const code=await totp(x.secret);
    faList.innerHTML+=`<div>${x.name}: <b>${code}</b></div>`;
  }
}

function openProfile(){
  alert("SĐT: "+localStorage.getItem(LOGIN));
}

if(localStorage.getItem(LOGIN)){
  authBox.classList.add("hide");
  app.classList.remove("hide");
  avatar.style.display="flex";
}
</script>
</body>
</html>
