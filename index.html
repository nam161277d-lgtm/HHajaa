<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DEV WITE ‚Äì Tools</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont}
body{margin:0;background:linear-gradient(180deg,#05070c,#0a0f1c);color:#e5e7eb}
.wrap{max-width:460px;margin:24px auto;padding:14px}
.card{background:#0b1220;border-radius:18px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
h1{text-align:center;color:#3b82f6;margin:0}
.sub{text-align:center;color:#9ca3af;font-size:13px;margin-bottom:10px}
input,button{width:100%;padding:14px;border-radius:14px;border:none;font-size:15px}
input{background:#020617;color:#e5e7eb;margin-bottom:10px}
.btn{font-weight:700;cursor:pointer}
.blue{background:#2563eb;color:#fff}
.gray{background:#1f2937;color:#e5e7eb}
.green{background:#22c55e;color:#04110a}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.pill{display:flex;gap:8px;margin-top:10px}
.pill button{flex:1}
.active{outline:2px solid #60a5fa}
.sep{height:1px;background:#1f2937;margin:14px 0}
.code{background:#020617;border-radius:12px;padding:12px;margin-top:8px;font-size:28px;letter-spacing:4px;text-align:center;color:#00ff9c}
.qrbox{display:none;text-align:center;margin-top:12px}
.qrbox img{width:200px;background:#fff;padding:8px;border-radius:12px}
.small{text-align:center;font-size:12px;color:#9ca3af;margin-top:6px}
.nav{display:flex;gap:8px;margin-bottom:10px}
.nav button{flex:1}
.hide{display:none}
.footer{text-align:center;font-size:12px;color:#9ca3af;margin-top:10px}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>DEV WITE</h1>
    <div class="sub">All-in-one: Change Pass + 2FA</div>

    <!-- NAV -->
    <div class="nav">
      <button class="btn gray" onclick="show('home')">üè† Trang ch·ªß</button>
      <button class="btn gray" onclick="show('pass')">üîÅ Change Pass</button>
      <button class="btn gray" onclick="show('fa')">üîê 2FA</button>
    </div>

    <!-- HOME -->
    <div id="home">
      <button class="btn blue" onclick="show('pass')">V√†o Change Pass</button>
      <button class="btn green" style="margin-top:10px" onclick="show('fa')">V√†o Get 2FA</button>
    </div>

    <!-- CHANGE PASS (KH√îNG L∆ØU) -->
    <div id="pass" class="hide">
      <div class="sub">Kh√¥ng l∆∞u UID/CODE ‚Ä¢ Gi·ªØ 3 link g·ªëc</div>
      <input id="uid" placeholder="UID (kh√¥ng l∆∞u)">
      <input id="code" placeholder="CODE MAIL (kh√¥ng l∆∞u)">
      <button class="btn blue" onclick="gen()">T·∫°o link</button>

      <div class="pill">
        <button id="v1" class="btn gray active" onclick="selectVer(1)">Ver1</button>
        <button id="v2" class="btn gray" onclick="selectVer(2)">Ver2</button>
        <button id="v3" class="btn gray" onclick="selectVer(3)">Ver3</button>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn gray" onclick="openLink()">M·ªü link</button>
        <button class="btn gray" onclick="copyLink()">Copy link</button>
      </div>

      <div class="qrbox" id="qrBox">
        <img id="qrImg">
        <div class="row" style="margin-top:8px">
          <button class="btn gray" onclick="copyQR()">Copy QR</button>
          <button class="btn gray" onclick="downloadQR()">Download QR</button>
        </div>
        <div class="small">QR t·ª± c·∫≠p nh·∫≠t theo Ver ƒëang ch·ªçn</div>
      </div>
    </div>

    <!-- 2FA (C√ì L∆ØU T√äN + SECRET) -->
    <div id="fa" class="hide">
      <div class="sub">Ghi nh·ªõ T√äN + SECRET (local)</div>
      <input id="faName" placeholder="T√™n 2FA (vd: Facebook, Gmail)">
      <input id="secret" placeholder="2FA Secret (Base32)">
      <div class="row">
        <button class="btn green" onclick="genTOTP()">GET M√É</button>
        <button class="btn gray" onclick="copyTOTP()">Copy</button>
      </div>
      <div id="totp" class="code">------</div>
      <div id="timer" class="small"></div>
    </div>

    <div class="footer">Client-side only ‚Ä¢ Kh√¥ng server</div>
  </div>
</div>

<script>
/* ===== NAV ===== */
function show(id){
  ['home','pass','fa'].forEach(x=>document.getElementById(x).classList.add('hide'));
  document.getElementById(id).classList.remove('hide');
}

/* ===== CHANGE PASS (KH√îNG L∆ØU) ===== */
let links={}, curVer=1;
function gen(){
  const uid=document.getElementById('uid').value.trim();
  const code=document.getElementById('code').value.trim();
  if(!uid||!code){alert('Nh·∫≠p UID & CODE');return;}
  links[1]=`https://www.site.com/recover/password/?u=${encodeURIComponent(uid)}&n=${encodeURIComponent(code)}&fl=default_recover&sih=0&ssb=1&msgr=0&rm=send_email`;
  links[2]=`https://www.site.com/recover/password/?u=${encodeURIComponent(uid)}&n=${encodeURIComponent(code)}&fl=in_autosend_experiment&sih=0&ssb=1&msgr=0&rm=send_email`;
  links[3]=`https://www.site.com/recover/password/?u=${encodeURIComponent(uid)}&n=${encodeURIComponent(code)}&fl=default_recover&sih=0&ssb=1&msgr=0&rm=send_email&_rdc=1&_rdr#`;
  updateQR();
}
function selectVer(v){
  curVer=v;
  ['v1','v2','v3'].forEach((id,i)=>document.getElementById(id).classList.toggle('active',i+1===v));
  updateQR();
}
function openLink(){ if(!links[curVer]) return alert('Ch∆∞a t·∫°o link'); window.open(links[curVer],'_blank'); }
function copyLink(){ if(!links[curVer]) return alert('Ch∆∞a t·∫°o link'); navigator.clipboard.writeText(links[curVer]); }
function updateQR(){
  if(!links[curVer]) return;
  const url="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data="+encodeURIComponent(links[curVer]);
  document.getElementById('qrImg').src=url;
  document.getElementById('qrBox').style.display='block';
}
function copyQR(){
  const img=document.getElementById('qrImg');
  fetch(img.src).then(r=>r.blob()).then(b=>navigator.clipboard.write([new ClipboardItem({'image/png':b})]));
}
function downloadQR(){
  const a=document.createElement('a'); a.href=document.getElementById('qrImg').src; a.download='qr.png'; a.click();
}

/* ===== 2FA (C√ì L∆ØU T√äN + SECRET) ===== */
const base32="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
function b32toBytes(s){
  s=s.replace(/=+$/,'').toUpperCase(); let bits='',out=[];
  for(const c of s){const v=base32.indexOf(c); if(v>-1) bits+=v.toString(2).padStart(5,'0')}
  for(let i=0;i+8<=bits.length;i+=8) out.push(parseInt(bits.slice(i,i+8),2));
  return new Uint8Array(out);
}
async function totp(secret){
  const key=b32toBytes(secret);
  const t=Math.floor(Date.now()/1000/30);
  const buf=new ArrayBuffer(8); new DataView(buf).setUint32(4,t);
  const k=await crypto.subtle.importKey('raw',key,{name:'HMAC',hash:'SHA-1'},false,['sign']);
  const h=new Uint8Array(await crypto.subtle.sign('HMAC',k,buf));
  const o=h[h.length-1]&0xf;
  const c=((h[o]&0x7f)<<24)|(h[o+1]<<16)|(h[o+2]<<8)|h[o+3];
  return (c%1e6).toString().padStart(6,'0');
}
let iv=null;
async function genTOTP(){
  const name=document.getElementById('faName').value.trim();
  const secret=document.getElementById('secret').value.trim();
  if(!secret) return alert('Nh·∫≠p secret');
  localStorage.setItem('faName',name);
  localStorage.setItem('faSecret',secret);
  clearInterval(iv);
  const upd=async()=>{
    document.getElementById('totp').innerText=await totp(secret);
    document.getElementById('timer').innerText='‚è≥ '+(30-(Math.floor(Date.now()/1000)%30))+'s';
  };
  await upd(); iv=setInterval(upd,1000);
}
function copyTOTP(){
  const c=document.getElementById('totp').innerText;
  if(c==='------')return; navigator.clipboard.writeText(c);
}
/* load saved 2FA only */
document.getElementById('faName').value=localStorage.getItem('faName')||'';
document.getElementById('secret').value=localStorage.getItem('faSecret')||'';
</script>
</body>
</html>
