<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Get 2FA</title>
<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont}
body{margin:0;background:linear-gradient(180deg,#05070c,#0a0f1c);color:#e5e7eb}
.wrap{max-width:420px;margin:40px auto;padding:16px}
.card{background:#0b1220;border-radius:18px;padding:20px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
h1{margin:0 0 6px;text-align:center;color:#3b82f6}
.sub{text-align:center;color:#9ca3af;font-size:13px;margin-bottom:16px}
input{width:100%;padding:14px;border-radius:12px;border:none;background:#020617;color:#e5e7eb}
.btn{width:100%;padding:14px;border-radius:14px;border:none;font-weight:700;margin-top:10px;cursor:pointer}
.green{background:#22c55e;color:#04110a}
.gray{background:#1f2937;color:#e5e7eb}
.code{background:#020617;border-radius:12px;padding:14px;margin-top:12px;
  font-size:28px;letter-spacing:4px;text-align:center;color:#00ff9c}
.hint{text-align:center;color:#9ca3af;font-size:12px;margin-top:6px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Get 2FA</h1>
      <div class="sub">Sinh m√£ TOTP (client-side)</div>

      <input id="secret" placeholder="2FA Secret (Base32)" />

      <button class="btn green" onclick="gen()">‚ö° GET M√É</button>
      <div id="code" class="code">------</div>
      <div id="timer" class="hint">‚Äî</div>

      <button class="btn gray" onclick="copy()">üìã Copy m√£</button>
      <button class="btn gray" onclick="location.href='/'">‚¨Ö Trang ch·ªß</button>
    </div>
  </div>

<script>
const base32Chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
function b32toBytes(s){
  s=s.replace(/=+$/,'').toUpperCase();
  let bits='',out=[];
  for(const c of s){const v=base32Chars.indexOf(c);if(v>-1)bits+=v.toString(2).padStart(5,'0')}
  for(let i=0;i+8<=bits.length;i+=8)out.push(parseInt(bits.slice(i,i+8),2));
  return new Uint8Array(out);
}
async function totp(secret){
  const key=b32toBytes(secret);
  const t=Math.floor(Date.now()/1000/30);
  const buf=new ArrayBuffer(8); new DataView(buf).setUint32(4,t);
  const k=await crypto.subtle.importKey('raw',key,{name:'HMAC',hash:'SHA-1'},false,['sign']);
  const h=new Uint8Array(await crypto.subtle.sign('HMAC',k,buf));
  const o=h[h.length-1]&0xf;
  const c=((h[o]&0x7f)<<24)|(h[o+1]<<16)|(h[o+2]<<8)|h[o+3];
  return (c%1e6).toString().padStart(6,'0');
}
let iv=null;
async function gen(){
  const s=document.getElementById('secret').value.trim();
  if(!s){alert('Nh·∫≠p secret');return;}
  clearInterval(iv);
  const upd=async()=>{
    document.getElementById('code').innerText=await totp(s);
    document.getElementById('timer').innerText='‚è≥ '+(30-(Math.floor(Date.now()/1000)%30))+'s';
  };
  await upd(); iv=setInterval(upd,1000);
}
function copy(){
  const c=document.getElementById('code').innerText;
  if(c==='------')return;
  navigator.clipboard.writeText(c); alert('ƒê√£ copy');
}
</script>
</body>
</html>
