<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DEV WITE TOOL</title>

<style>
:root{
  --bg:#0b0f19;
  --card:#121826;
  --border:#1f2937;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --primary:#3b82f6;
  --danger:#ef4444;
  --success:#22c55e;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  display:flex;
  justify-content:center
}
.container{
  width:100%;
  max-width:420px;
  padding:16px
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
  margin-top:16px
}
h1{
  text-align:center;
  margin:0;
  color:var(--primary)
}
.sub{
  text-align:center;
  color:var(--muted);
  font-size:13px;
  margin-bottom:10px
}
input,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#0f172a;
  color:var(--text);
  font-size:15px;
  margin-top:10px
}
button{
  cursor:pointer;
  font-weight:600
}
.btn-primary{background:var(--primary);border:none}
.btn-danger{background:var(--danger);border:none}
.btn-success{background:var(--success);border:none;color:#04110a}
.btn-ghost{background:#0f172a}
.hide{display:none}
.tabs{
  display:flex;
  gap:8px;
  margin-bottom:10px
}
.tabs button{flex:1}
.code{
  text-align:center;
  font-size:30px;
  letter-spacing:4px;
  margin-top:10px
}
.list div{
  padding:8px 0;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center
}
.avatar{
  position:fixed;
  top:12px;
  right:12px;
  width:38px;
  height:38px;
  border-radius:50%;
  background:var(--primary);
  display:none;
  justify-content:center;
  align-items:center;
  font-weight:700;
  cursor:pointer;
  z-index:10
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:20
}
.modal-box{
  background:var(--card);
  border-radius:16px;
  padding:20px;
  width:90%;
  max-width:320px
}
</style>
</head>

<body>

<div class="avatar" id="avatar" onclick="openProfile()">U</div>

<div class="container">

<!-- AUTH -->
<div id="authBox" class="card">
  <h1>DEV WITE</h1>
  <div class="sub">Đăng ký / Đăng nhập</div>

  <input id="phone" placeholder="Số điện thoại">
  <input id="pass" type="password" placeholder="Mật khẩu">

  <button class="btn-primary" onclick="register()">Đăng ký</button>
  <button class="btn-ghost" onclick="login()">Đăng nhập</button>
  <button class="btn-ghost" onclick="openForgot()">Quên mật khẩu?</button>

  <div id="msg" class="sub"></div>
</div>

<!-- APP -->
<div id="app" class="card hide">
  <div class="tabs">
    <button onclick="showTab('pass')">Change Pass</button>
    <button onclick="showTab('fa')">2FA</button>
    <button onclick="showTab('renew')">Gia hạn</button>
  </div>

  <!-- CHANGE PASS -->
  <div id="passTab" class="hide">
    <input id="uid" placeholder="UID">
    <input id="code" placeholder="CODE MAIL">
    <button class="btn-primary" onclick="genLinks()">Tạo link</button>
    <button onclick="openLink(1)">Ver1</button>
    <button onclick="openLink(2)">Ver2</button>
    <button onclick="openLink(3)">Ver3</button>
  </div>

  <!-- 2FA -->
  <div id="faTab" class="hide">
    <input id="faName" placeholder="Tên 2FA">
    <input id="faSecret" placeholder="Secret 2FA">
    <button class="btn-success" onclick="add2FA()">GET MÃ</button>
    <div id="totp" class="code">------</div>
    <div id="faList" class="list"></div>
  </div>

  <!-- RENEW -->
  <div id="renewTab" class="hide">
    <div class="sub">Liên hệ admin để gia hạn Change Pass</div>
    <a href="https://t.me/wite_dev" target="_blank">
      <button class="btn-primary">Telegram @wite_dev</button>
    </a>
  </div>

  <button class="btn-danger" onclick="logout()">Đăng xuất</button>
</div>

</div>

<!-- FORGOT MODAL -->
<div id="forgotModal" class="modal">
  <div class="modal-box">
    <h3>Quên mật khẩu</h3>
    <p class="sub">Vui lòng liên hệ Telegram admin để hỗ trợ</p>
    <a href="https://t.me/wite_dev" target="_blank">
      <button class="btn-primary">Telegram</button>
    </a>
    <button onclick="closeForgot()">Đóng</button>
  </div>
</div>

<!-- PROFILE MODAL -->
<div id="profileModal" class="modal">
  <div class="modal-box">
    <h3>Hồ sơ</h3>
    <p id="pPhone"></p>
    <p id="pExpire"></p>
    <button onclick="closeProfile()">Đóng</button>
  </div>
</div>

<script>
/* ===== STORAGE ===== */
const ACC_KEY="DEVWITE_ACCOUNTS";
const LOGIN_KEY="DEVWITE_LOGIN";

/* ===== HELPERS ===== */
function getAcc(){
  return JSON.parse(localStorage.getItem(ACC_KEY)||"{}");
}
function saveAcc(a){
  localStorage.setItem(ACC_KEY,JSON.stringify(a));
}
async function hash(t){
  const b=await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(t)
  );
  return [...new Uint8Array(b)]
    .map(x=>x.toString(16).padStart(2,"0"))
    .join("");
}

/* ===== AUTH ===== */
async function register(){
  const a=getAcc();
  if(a[phone.value]){
    msg.innerText="Tài khoản đã tồn tại";
    return;
  }
  a[phone.value]={
    pass:await hash(pass.value),
    expire:null,
    twofa:[]
  };
  saveAcc(a);
  msg.innerText="Đăng ký thành công";
}

async function login(){
  const a=getAcc();
  if(!a[phone.value]){
    msg.innerText="Tài khoản không tồn tại";
    return;
  }
  if(a[phone.value].pass!==await hash(pass.value)){
    msg.innerText="Sai mật khẩu";
    return;
  }
  localStorage.setItem(LOGIN_KEY,phone.value);
  location.reload();
}

function logout(){
  localStorage.removeItem(LOGIN_KEY);
  location.reload();
}

/* ===== UI ===== */
function showTab(t){
  passTab.classList.add("hide");
  faTab.classList.add("hide");
  renewTab.classList.add("hide");
  document.getElementById(t+"Tab").classList.remove("hide");
}

function openForgot(){
  forgotModal.style.display="flex";
}
function closeForgot(){
  forgotModal.style.display="none";
}

function openProfile(){
  const p=localStorage.getItem(LOGIN_KEY);
  const a=getAcc()[p];
  pPhone.innerText="SĐT: "+p;
  pExpire.innerText=a.expire
    ?("Hết hạn: "+a.expire)
    :"Chưa gia hạn";
  profileModal.style.display="flex";
}
function closeProfile(){
  profileModal.style.display="none";
}

/* ===== CHANGE PASS ===== */
let links={};
function genLinks(){
  links={
    1:`https://www.site.com/recover/password/?u=${uid.value}&n=${code.value}`,
    2:`https://www.site.com/recover/password/?u=${uid.value}&n=${code.value}&v=2`,
    3:`https://www.site.com/recover/password/?u=${uid.value}&n=${code.value}&v=3`
  };
}
function openLink(v){
  if(links[v]) window.open(links[v],"_blank");
}

/* ===== 2FA ===== */
async function makeTOTP(secret){
  const base32="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
  let bits="";
  for(const c of secret.replace(/=+$/,"")){
    bits+=base32.indexOf(c).toString(2).padStart(5,"0");
  }
  let bytes=[];
  for(let i=0;i+8<=bits.length;i+=8){
    bytes.push(parseInt(bits.slice(i,i+8),2));
  }
  const key=await crypto.subtle.importKey(
    "raw",
    new Uint8Array(bytes),
    {name:"HMAC",hash:"SHA-1"},
    false,
    ["sign"]
  );
  const buf=new ArrayBuffer(8);
  new DataView(buf).setUint32(4,Math.floor(Date.now()/1000/30));
  const h=new Uint8Array(await crypto.subtle.sign("HMAC",key,buf));
  const o=h[h.length-1]&15;
  return (
    ((h[o]&127)<<24|
    (h[o+1]<<16)|
    (h[o+2]<<8)|
    h[o+3])%1e6
  ).toString().padStart(6,"0");
}

async function add2FA(){
  const p=localStorage.getItem(LOGIN_KEY);
  const a=getAcc();
  a[p].twofa.push({
    name:faName.value,
    secret:faSecret.value
  });
  saveAcc(a);
  render2FA();
}

async function render2FA(){
  const p=localStorage.getItem(LOGIN_KEY);
  const a=getAcc()[p];
  faList.innerHTML="";
  for(const x of a.twofa){
    const code=await makeTOTP(x.secret);
    faList.innerHTML+=
      `<div><b>${x.name}</b><span>${code}</span></div>`;
  }
}

/* ===== INIT ===== */
const cur=localStorage.getItem(LOGIN_KEY);
if(cur){
  authBox.classList.add("hide");
  app.classList.remove("hide");
  avatar.style.display="flex";
  avatar.innerText=cur[0].toUpperCase();
}
</script>
</body>
</html>
